{% extends 'KunstmaanMediaBundle:Default:layout.html.twig' %}

{% block header %}
    <div class="page-header">
        <h1>{{ 'media.image.image'|trans }} <small>{{ media.name }}</small></h1>
    </div>
{% endblock %}

{% block content %}

    {% include 'KunstmaanMediaBundle:Media:sure-modal.html.twig' %}

    <div class="main_actions">
        <a href="#" class="btn primary type" onclick="return launchEditor('editimage', '{{ app.request.getScheme()~'://'~app.request.getHttpHost()~asset(upload_dir~media.show()) }}');" >{{ 'media.image.edit' | trans }}</a>
        {% if hasmetadata %}
            <a href="{{ path('KunstmaanMediaBundle_metadata_edit', { 'media_id': media.id}) }}" class="btn primary type">{{ 'media.image.editmetadata' | trans }}</a>
        {% endif %}
        <a href="{{ path('KunstmaanMediaBundle_media_delete', { 'media_id': media.id }) }}" data-controls-modal="sure-modal-{{ media.id }}" data-backdrop="true" data keyboard="true" class="btn danger">{{ 'form.delete'|trans }}</a>
        <a href="{{ path('KunstmaanMediaBundle_folder_show', { 'id': gallery.id, 'slug': gallery.slug }) }}" class="btn">{{ 'form.cancel' | trans }}</a>
    </div>

    <div id="main_actions_top" class="main_actions top">
        <div class="pull-right">
            <a href="#" class="btn primary type" onclick="return launchEditor('editimage', '{{ app.request.getScheme()~'://'~app.request.getHttpHost()~asset(upload_dir~media.show()) }}');" >{{ 'media.image.edit' | trans }}</a>
            {% if hasmetadata %}
            <a href="{{ path('KunstmaanMediaBundle_metadata_edit', { 'media_id': media.id}) }}" class="btn primary type">{{ 'media.image.editmetadata' | trans }}</a>
            {% endif %}
            <a href="{{ path('KunstmaanMediaBundle_media_delete', { 'media_id': media.id }) }}" data-controls-modal="sure-modal-{{ media.id }}" data-backdrop="true" data keyboard="true" class="btn danger">{{ 'form.delete'|trans }}</a>
            <a href="{{ path('KunstmaanMediaBundle_folder_show', { 'id': gallery.id, 'slug': gallery.slug }) }}" class="btn">{{ 'form.cancel' | trans }}</a>
            <a class="btn up">&#9650;</a>
        </div>
    </div>

    <ul class="tabs" data-tabs="tabs">
        <li class="active"><a href="#imagegallery">{{ 'media.file.file'|trans|capitalize }}</a></li>
        <li><a href="#edits">{{ 'media.image.edits' | trans }}</a></li>
    </ul>

    <div id="my-tab-content" class="tab-content">
        <div class="tab-pane active" id="imagegallery">

            <ul>
                <li>Name: {{ media.name }} </li>
                <li>Content-type: {{ media.contentType }}</li>
                <li>Added; {{ media.createdat|date|escape }}</li>
                <li>Updated: {{ media.updatedat|date|escape }}</li>
            </ul>

            <p><img id="editimage" class="thumbnail" src="{{ asset(upload_dir~media.show()) }}" alt="{{ media.name }}" /></p>

            <!-- Load Feather code -->
            <script type="text/javascript" src="http://feather.aviary.com/js/feather.js"></script>

            <!-- Instantiate Feather -->
            <script type="text/javascript">
                var featherEditor = new Aviary.Feather({
                    apiKey: '5f257cbef',
                    apiVersion: 2,
                    //tools: 'all',
                    onSave: function(imageID, newURL) {
                        var img = document.getElementById(imageID);
                        img.src = newURL;
                        window.location = '{{ url('KunstmaanMediaBundle_aviary', { 'gallery_id' : gallery.id, 'image_id' : media.id }) }}?url='+newURL;
                    }

                });

                function launchEditor(id, src) {
                    featherEditor.launch({
                        image: id,
                        url: src
                    });
                    return false;
                }
            </script>

            <div id="injection_site"></div>
        </div>

        <div class="tab-pane" id="edits">
            <ul class="media-grid">
                {% for image in media.edits %}
                <li>
                    <a href="{{ path('KunstmaanMediaBundle_media_show',  { 'media_id' : image.id }) }}">
                        <img class="thumbnail" src="{{ asset(upload_dir~image.show('medium')) }}" alt="{{ image.name }}" />
                    </a>
                </li>
                {% else %}
                <ul><li>{{ 'media.image.noedits' | trans }}</li></ul>
                {% endfor %}
            </ul>
        </div>
    </div>

{% endblock %}